#!/bin/bash

FLAG=$MABEN_PATH/maben_updated
LASTMOD_MAX=0

echo "$(tput setaf 2)$MABEN $(tput sgr0)"

while [[ $# -gt 0 ]]
do
key="$1"

case $key in
    -h|--help)
    ;;
    update)
		cd $MABEN_PATH && git pull && touch $FLAG
		unset $MABEN && $MABEN_PATH/init
    ;;
    --check)
		if [ ! -f $FLAG ]; then
			touch $FLAG
		fi
		lastmod=$(( $(date +%s) - $(stat -c %Y $FLAG) ))
		if [ $lastmod -gt $LASTMOD_MAX ]; then
			echo "$(tput setaf 3)Checking for update... $(tput sgr0)"
			cd $MABEN_PATH
			git fetch
			outdated="$(git status | grep behind -c)"
			if [ $outdated -ne 0 ]; then
				echo "$(tput setaf 1)maben is outdated. Use \"maben update\" command. $(tput sgr0)"
			else
				touch $FLAG
			fi
		fi
    ;;
    *)
            # unknown option
    ;;
esac
shift # past argument or value
done

